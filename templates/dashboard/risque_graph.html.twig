<!-- Inclure Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Graphique -->
<div style="width: 80%; margin: auto;">
    <canvas id="riskCoursePriceChart"></canvas>
</div>

<script>
    // Récupérer les données du graphique depuis Twig
    const graphData = {{ graphData|json_encode|raw }};

    // Préparer les données pour Chart.js
    const dataPoints = [];
    const riskLevelMap = {
        'Low Risk': 1,
        'Moderate Risk': 2,
        'High Risk': 3,
    };

    // Parcourir chaque cours et ses risques associés
    Object.values(graphData).forEach(course => {
        const coursePrice = course.coursePrice;
        course.riskLevels.forEach(riskLevel => {
            dataPoints.push({
                x: riskLevelMap[riskLevel], // Niveau de risque (numérique)
                y: coursePrice, // Prix du cours
            });
        });
    });

    // Créer le graphique
    const ctx = document.getElementById('riskCoursePriceChart').getContext('2d');
    new Chart(ctx, {
        type: 'scatter', // Type de graphique (nuage de points)
        data: {
            datasets: [{
                label: 'Prix des cours vs Risque de non-paiement',
                data: dataPoints,
                backgroundColor: 'rgba(75, 192, 192, 0.5)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Prix du cours (TND)'
                    }
                },
                x: {
                    type: 'linear',
                    position: 'bottom',
                    ticks: {
                        callback: function(value) {
                            // Convertir les valeurs numériques en libellés de risque
                            const reverseMap = {
                                1: 'Low Risk',
                                2: 'Moderate Risk',
                                3: 'High Risk',
                            };
                            return reverseMap[value];
                        }
                    },
                    title: {
                        display: true,
                        text: 'Niveau de risque'
                    }
                }
            }
        }
    });
</script>